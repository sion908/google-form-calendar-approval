
# Googleフォームとカレンダー連携 承認フローシステム

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## 目次
- [概要](#概要)
- [主な機能](#主な機能)
- [セットアップ手順](#セットアップ手順)
- [使い方](#使い方)
- [トラブルシューティング](#トラブルシューティング)
- [カスタマイズ](#カスタマイズ)
- [ファイル構成](#ファイル構成)
- [ライセンス](#ライセンス)

## 概要

Googleフォームからの予定申請を承認フローを経てGoogleカレンダーに登録する自動化システムです。承認者による承認を経ることで、適切な予定のみがカレンダーに登録されます。

## 主な機能

### 申請者向け
- **簡単なフォーム入力** - イベント名、日時、場所、説明を入力するだけ
- **申請状況の確認** - 承認待ち/承認済み/却下のステータスを確認可能
- **却下時の再申請** - 却下理由を確認し、内容を修正して再申請が可能

### 承認者向け
- **ワンクリック承認** - メールから1クリックで承認可能
- **却下理由の入力** - 却下時は理由を入力してフィードバック
- **カレンダー自動登録** - 承認後は自動的にカレンダーに登録

## セットアップ手順

### 1. 必要な権限の確認
- Googleドライブへのアクセス権限
- Googleカレンダーの編集権限
- Googleフォームの作成・編集権限

### 2. スクリプトのセットアップ

1. 新しいGoogleスプレッドシートを作成
2. メニューから「拡張機能」→「Apps Script」を選択
3. 左側のファイル一覧から「＋」ボタンをクリックし、以下のファイルを作成:
   - `main.gs`
   - `approval.gs`
   - `calendar.gs`
   - `email.gs`
   - `properties.gs`
   - `constants.gs`
   - `rejection-form-template.html`
   - `approval-form.html`

4. `setup.gs` ファイルを新規作成し、以下のコードを追加:

```javascript
function onOpen() {
  SpreadsheetApp.getUi()
    .createMenu('カレンダー承認システム')
    .addItem('セットアップ', 'setupSpreadsheet')
    .addItem('設定を確認', 'showSettings')
    .addToUi();
}

function setupSpreadsheet() {
  const result = setupSpreadsheet();
  SpreadsheetApp.getUi().alert('セットアップ完了', result, SpreadsheetApp.getUi().ButtonSet.OK);
}
```

5. スクリプトエディタで「保存」をクリック

### 3. トリガーの設定

1. スクリプトエディタで、左側の時計のようなアイコン（トリガー）をクリック
2. 「トリガーを追加」をクリック
3. 以下のように設定:
   - 実行する関数: `onFormSubmit`
   - 実行するデプロイ: ヘッド
   - イベントのソース: スプレッドシートから
   - イベントの種類: フォーム送信時

### 4. Webアプリケーションとしてデプロイ

1. スクリプトエディタで「デプロイ」→「新しいデプロイ」を選択
2. 歯車アイコンをクリックして「ウェブアプリ」を選択
3. 以下のように設定:
   - 説明: カレンダー承認システム
   - 次のユーザーとして実行: 自分
   - アクセスできるユーザー: 全員（匿名ユーザーを含む）
4. 「デプロイ」をクリック
5. 表示されたURLをメモしておく（後で使用します）

## 使い方

### 管理者向け

1. **初期設定**
   - スプレッドシートを開き、メニューから「カレンダー承認システム」→「セットアップ」を実行
   - 必要なシートとカラムが自動的に作成されます

2. **承認者の設定**
   - `constants.gs` の `APPROVER_EMAILS` に承認者のメールアドレスを設定
   - 複数人の場合はカンマ区切りで指定

3. **フォームの設定**
   - フォームの回答先を設定したスプレッドシートに設定
   - フォームの回答通知メールを設定（任意）

### ユーザー向け

1. **予定の申請**
   - Googleフォームにアクセス
   - 必要な情報を入力して送信
   - 承認待ちのメールが自動送信されます

2. **申請状況の確認**
   - 承認待ち/承認済み/却下のステータスをスプレッドシートで確認
   - 却下された場合は、メールで通知され、再申請が可能です

3. **予定の編集・キャンセル**
   - 承認前: フォームの回答を編集して再送信
   - 承認後: カレンダーから直接編集または削除

## トラブルシューティング

### 承認メールが届かない場合
- 迷惑メールフォルダを確認
- メールアドレスの入力ミスがないか確認
- スクリプトの実行ログを確認

### カレンダーに予定が登録されない場合
- カレンダーへの編集権限を確認
- スクリプトの実行ログでエラーを確認
- トリガーが正しく設定されているか確認

## カスタマイズ

### メールテンプレートの変更
- `email.gs` の各メール送信関数を編集
- HTML形式で自由にカスタマイズ可能

### 承認フローの変更
- `approval.gs` の処理を修正
- 複数承認者や条件分岐を追加可能

### フォーム項目の追加
1. フォームに項目を追加
2. `constants.gs` の `FORM_RESPONSES` に項目を追加
3. 必要に応じて `main.gs` の処理を修正

## ファイル構成

- `main.gs` - メインの処理（フォーム送信時のトリガーなど）
- `approval.gs` - 承認・却下処理のロジック
- `calendar.gs` - Googleカレンダー連携処理
- `email.gs` - メール送信処理
- `properties.gs` - プロパティ管理
- `constants.gs` - 定数定義
- `approval-form.html` - 承認フォームのUI
- `rejection-form-template.html` - 却下フォームのUI

## ライセンス

このプロジェクトは [MITライセンス](LICENSE) で提供されています。



https://qiita.com/ume3003/items/cd9d05dff014952a73f8
